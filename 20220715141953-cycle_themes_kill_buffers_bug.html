<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>=cycle-themes= kill buffers bug</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/3eaa1068495066ef.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3eaa1068495066ef.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js" defer=""></script><script src="/_next/static/chunks/framework-a85322f027b40e20.js" defer=""></script><script src="/_next/static/chunks/main-00e108e884e8ba17.js" defer=""></script><script src="/_next/static/chunks/pages/_app-60a5035e093629b8.js" defer=""></script><script src="/_next/static/chunks/929-fd697a5772151b77.js" defer=""></script><script src="/_next/static/chunks/329-4859dea2fee324e7.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...slug%5D%5D-36a5cddfb88d7ae3.js" defer=""></script><script src="/_next/static/64fsrL30VQFq9__eTQ_St/_buildManifest.js" defer=""></script><script src="/_next/static/64fsrL30VQFq9__eTQ_St/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main><h1>=cycle-themes= kill buffers bug</h1><section><h5>Tags</h5><ul>:elisp:emacs:debug:</ul></section><h1 id="description">description</h1><p>When running <a href="/~/dotfiles/.emacs::defun%20cycle-themes%20(%CF%86n">cycle-themes</a>, I&#x27;d get prompted:
</p><blockquote><p>The current server still has clients; delete them?
</p></blockquote><h1 id="what-it-ended-up-being">what it ended up being</h1><p><a href="/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/custom.el.gz::defun%20enable-theme%20(theme"><code class="inline-verbatim">enable-theme</code></a> makes a call to <a href="/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/custom.el.gz::defun%20custom-theme-recalc-variable%20(variable"><code class="inline-verbatim">custom-theme-recalc-variable</code></a> , which in turn runs:
</p><pre class="src-block"><code class="language-elisp">(funcall (or (get variable &#x27;custom-set) #&#x27;set-default) variable
</code></pre><p>Some of the variables in question are also minor modes, among them <a href="/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/server.el.gz::(define-minor-mode%20server-mode"><code class="inline-verbatim">server-mode</code></a>. Which for some reason was set to <code class="inline-verbatim">t</code> in Custom?
</p><h1 id="fixed-it-by">fixed it by</h1><p>removing that from custom. we were fine then.
</p><h1 id="things-i-did-to-debug">things I did to debug</h1><p><code class="inline-verbatim">M-x debug-on-entry enable-theme</code>, then step through the frames until the truly inexplicable moment happened where server-mode was being set to t.
</p><section><h2>Backlinks</h2><ul><li><a href="/20240822193504-emacs">Emacs</a></li></ul></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"=cycle-themes= kill buffers bug","hast":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{"id":"description"},"children":[{"type":"text","value":"description"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When running "},{"type":"element","tagName":"a","properties":{"href":"/~/dotfiles/.emacs::defun%20cycle-themes%20(%CF%86n"},"children":[{"type":"text","value":"cycle-themes"}]},{"type":"text","value":", I'd get prompted:\n"}]},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The current server still has clients; delete them?\n"}]}]},{"type":"element","tagName":"h1","properties":{"id":"what-it-ended-up-being"},"children":[{"type":"text","value":"what it ended up being"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/custom.el.gz::defun%20enable-theme%20(theme"},"children":[{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"enable-theme"}]}]},{"type":"text","value":" makes a call to "},{"type":"element","tagName":"a","properties":{"href":"/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/custom.el.gz::defun%20custom-theme-recalc-variable%20(variable"},"children":[{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"custom-theme-recalc-variable"}]}]},{"type":"text","value":" , which in turn runs:\n"}]},{"type":"element","tagName":"pre","properties":{"className":["src-block"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-elisp"]},"children":[{"type":"text","value":"(funcall (or (get variable 'custom-set) #'set-default) variable\n"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some of the variables in question are also minor modes, among them "},{"type":"element","tagName":"a","properties":{"href":"/nix/store/2hqgz9qa19qwfgz0qk3kna3qlqxwjkyz-emacs-27.2/share/emacs/27.2/lisp/server.el.gz::(define-minor-mode%20server-mode"},"children":[{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"server-mode"}]}]},{"type":"text","value":". Which for some reason was set to "},{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"t"}]},{"type":"text","value":" in Custom?\n"}]},{"type":"element","tagName":"h1","properties":{"id":"fixed-it-by"},"children":[{"type":"text","value":"fixed it by"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"removing that from custom. we were fine then.\n"}]},{"type":"element","tagName":"h1","properties":{"id":"things-i-did-to-debug"},"children":[{"type":"text","value":"things I did to debug"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["inline-verbatim"]},"children":[{"type":"text","value":"M-x debug-on-entry enable-theme"}]},{"type":"text","value":", then step through the frames until the truly inexplicable moment happened where server-mode was being set to t.\n"}]}]},"filetags":":elisp:emacs:debug:","backlinks":[{"path":"/20240822193504-emacs","title":"Emacs"}]},"__N_SSG":true},"page":"/[[...slug]]","query":{"slug":["20220715141953-cycle_themes_kill_buffers_bug"]},"buildId":"64fsrL30VQFq9__eTQ_St","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>